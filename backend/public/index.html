<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Studio - Content Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #FFF8F3;
            color: #2D1B00;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .header h1 {
            color: #E67E22;
            margin-bottom: 10px;
        }

        .auth-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .admin-section {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2D1B00;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #F4E6D7;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            color: #2D1B00;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #E67E22;
        }

        button {
            background: #E67E22;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        button:hover {
            background: #D35400;
        }

        button.secondary {
            background: #8B6F47;
        }

        button.secondary:hover {
            background: #6B5B47;
        }

        button.danger {
            background: #e74c3c;
        }

        button.danger:hover {
            background: #c0392b;
        }

        .slides-list {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .slide-item {
            border: 2px solid #F4E6D7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .slide-image {
            width: 120px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
        }

        .slide-content {
            flex: 1;
        }

        .slide-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2D1B00;
        }

        .slide-description {
            color: #8B6F47;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .slide-meta {
            font-size: 12px;
            color: #E67E22;
            font-weight: 500;
        }

        .slide-actions {
            display: flex;
            gap: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #8B6F47;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #8B6F47;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider-toggle {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #F4E6D7;
            transition: .4s;
            border-radius: 34px;
        }

        .slider-toggle:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider-toggle {
            background-color: #E67E22;
        }

        input:checked + .slider-toggle:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Mind Studio - Content Management</h1>
            <p>Manage your website content, slider images, and settings.</p>
        </div>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <h2>üîê Admin Login</h2>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter admin password">
            </div>
            <button onclick="authenticate()">Login</button>
        </div>

        <!-- Admin Panel -->
        <div id="adminSection" class="admin-section">
            <!-- Add New Slide -->
            <div class="auth-section">
                <h2>‚ûï Add New Slide</h2>
                <form id="slideForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="title">Title:</label>
                        <input type="text" id="title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description:</label>
                        <textarea id="description" name="description" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="meta">Meta/Category:</label>
                        <input type="text" id="meta" name="meta" placeholder="e.g., Testimonial, Service, About">
                    </div>
                    <div class="form-group">
                        <label for="imageDesktop">Desktop Image (recommended: 1200x600px):</label>
                        <input type="file" id="imageDesktop" name="imageDesktop" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="imageMobile">Mobile Image (recommended: 800x600px):</label>
                        <input type="file" id="imageMobile" name="imageMobile" accept="image/*">
                        <small style="color: #8B6F47; font-size: 12px; margin-top: 5px; display: block;">
                            Optional: If not provided, desktop image will be used for mobile devices
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="order">Order:</label>
                        <input type="number" id="order" name="order" value="0">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="active" name="active" checked>
                            Active
                        </label>
                    </div>
                    <button type="submit">Add Slide</button>
                </form>
            </div>

            <!-- Slides List -->
            <div class="slides-list">
                <h2>üì∏ Current Slides</h2>
                <div id="slidesContainer">
                    <div class="loading">Loading slides...</div>
                </div>
            </div>
        </div>

        <div id="alertContainer"></div>
    </div>

    <script>
        let authToken = null;
        const API_BASE = window.location.origin;

        // Authentication
        function authenticate() {
            const password = document.getElementById('password').value;
            if (!password) {
                showAlert('Please enter a password', 'error');
                return;
            }

            authToken = btoa(password); // Simple base64 encoding
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('adminSection').style.display = 'block';
            loadSlides();
        }

        // Show alerts
        function showAlert(message, type = 'success') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Load slides
        async function loadSlides() {
            try {
                const response = await fetch(`${API_BASE}/api/slider`);
                const slides = await response.json();
                displaySlides(slides);
            } catch (error) {
                console.error('Error loading slides:', error);
                showAlert('Failed to load slides', 'error');
            }
        }

        // Display slides
        function displaySlides(slides) {
            const container = document.getElementById('slidesContainer');
            
            if (slides.length === 0) {
                container.innerHTML = '<div class="empty-state">No slides found. Add your first slide above!</div>';
                return;
            }

            container.innerHTML = slides.map(slide => {
                const hasImages = slide.images && (slide.images.desktop || slide.images.mobile);
                let imageHtml = '<div class="slide-image" style="background: #F4E6D7; display: flex; align-items: center; justify-content: center; color: #8B6F47;">No Image</div>';
                
                if (hasImages) {
                    const desktopImg = slide.images.desktop ? `${API_BASE}${slide.images.desktop}` : null;
                    const mobileImg = slide.images.mobile ? `${API_BASE}${slide.images.mobile}` : null;
                    
                    if (desktopImg && mobileImg) {
                        imageHtml = `
                            <div style="display: flex; gap: 5px;">
                                <img src="${desktopImg}" alt="${slide.title} (Desktop)" class="slide-image" style="width: 60px; height: 40px;">
                                <img src="${mobileImg}" alt="${slide.title} (Mobile)" class="slide-image" style="width: 60px; height: 40px;">
                            </div>
                        `;
                    } else if (desktopImg) {
                        imageHtml = `<img src="${desktopImg}" alt="${slide.title}" class="slide-image">`;
                    } else if (mobileImg) {
                        imageHtml = `<img src="${mobileImg}" alt="${slide.title}" class="slide-image">`;
                    }
                }
                
                return `
                    <div class="slide-item">
                        ${imageHtml}
                        <div class="slide-content">
                            <div class="slide-title">${slide.title}</div>
                            <div class="slide-description">${slide.description}</div>
                            <div class="slide-meta">
                                ${slide.meta} ‚Ä¢ Order: ${slide.order} ‚Ä¢ ${slide.active ? 'Active' : 'Inactive'}
                                ${hasImages ? ` ‚Ä¢ ${slide.images.desktop ? 'Desktop' : ''}${slide.images.desktop && slide.images.mobile ? ' + ' : ''}${slide.images.mobile ? 'Mobile' : ''}` : ''}
                            </div>
                        </div>
                        <div class="slide-actions">
                            <button onclick="toggleSlide('${slide.id}', ${!slide.active})" class="secondary">
                                ${slide.active ? 'Deactivate' : 'Activate'}
                            </button>
                            <button onclick="deleteSlide('${slide.id}')" class="danger">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Add new slide
        document.getElementById('slideForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            formData.append('active', document.getElementById('active').checked);

            try {
                const response = await fetch(`${API_BASE}/api/admin/slider`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('Slide added successfully!');
                    e.target.reset();
                    loadSlides();
                } else {
                    showAlert(result.error || 'Failed to add slide', 'error');
                }
            } catch (error) {
                console.error('Error adding slide:', error);
                showAlert('Failed to add slide', 'error');
            }
        });

        // Toggle slide active status
        async function toggleSlide(id, active) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/slider/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ active })
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert(`Slide ${active ? 'activated' : 'deactivated'} successfully!`);
                    loadSlides();
                } else {
                    showAlert(result.error || 'Failed to update slide', 'error');
                }
            } catch (error) {
                console.error('Error updating slide:', error);
                showAlert('Failed to update slide', 'error');
            }
        }

        // Delete slide
        async function deleteSlide(id) {
            if (!confirm('Are you sure you want to delete this slide?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/admin/slider/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('Slide deleted successfully!');
                    loadSlides();
                } else {
                    showAlert(result.error || 'Failed to delete slide', 'error');
                }
            } catch (error) {
                console.error('Error deleting slide:', error);
                showAlert('Failed to delete slide', 'error');
            }
        }
    </script>
</body>
</html>
